<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Imperial Analysis: HiggsToTauTau - Run2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen2.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 70px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Imperial Analysis
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('higgs-to-tau-tau-UL.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">HiggsToTauTau - UL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#htt-cmssw-UL">Ntuple Production </a></li>
<li class="level1"><a href="#htt-ntuple_production-UL">Ntuple Production </a></li>
<li class="level1"><a href="#htt-event-selection-UL">Selection of events </a></li>
<li class="level1"><a href="#htt-datacards-UL">Producing plots and datacards </a></li>
</ul>
</div>
<div class="textblock"><p>This page gives instructions for running the Higgs to tau tau analysis in the UL 13 TeV data. The workflow is similar to that used during Run 1 + 2 rereco with some further improvements. The code now supports mutau, etau, emu and tautau channels, as well as Z-&gt;ee and Z-&gt;mumu channels. We attempt for now to keep backwards compatibility with the rereco Run2 analysis, although the possibility also remains to use an old branch of the code and instructions described on the previous page.</p>
<p>The full analysis chain involves several steps, each outlined in a section below.</p>
<h1><a class="anchor" id="htt-cmssw-UL"></a>
CMSSW Set Up </h1>
<p>Create a new CMSSW area: 
# The SCRAM_ARCH parameter will depend on what CMSSW release you are trying to use. For using the analyser and ntuple production we are currently use CMSSW_10_2_19 and CMSSW_10_6_19 respectively.
scramv1 project CMSSW CMSSW_10_6_19
cd CMSSW_10_6_19/src/
cmsenv
</pre><p>Initialise this area for git by adding a single package: </p><pre class="fragment">git cms-addpkg FWCore/Version
# If you are not running on a machine based at CERN, this script will ask if you want to create a new reference repository.
# You should answer yes to this, and the script will copy the entire cmssw repository to your home folder,
# which will make setting up subsequent release areas a lot faster.
</pre><p>This command will have created two remote repositories, <code>official-cmssw</code> and <code>my-cmssw</code>. It will also have created and switched to a new branch, <code>from-CMSSW_X_Y_Z</code>. An additional remote can be added which provides the pre-configured branches shared by the group: </p><pre class="fragment">git remote add ic-cmssw git@github.com:gputtley/cmssw.git
# fetch from the ic-cmssw remote repository and merge the from-CMSSW_X_Y_Z into your own local branch.
git pull ic-cmssw from-CMSSW_10_6_19

# At this point, if you run 'ls' you will not see any new packages in the release area.
# This is because the repository operates in sparse-checkout mode, hiding folders unless they are
# explicitly made visible.  This is important, as we don't want to have to compile every single package.
# To make the packages visible that have been modified from the release tag, run these commands:

git cms-sparse-checkout CMSSW_10_6_19 HEAD
git read-tree -mu HEAD

</pre><p>Next, add the IC analysis code package. For ntuple production use: </p><pre class="fragment">git clone -b 4tau git@github.com:danielwinterbottom/ICHiggsTauTau.git UserCode/ICHiggsTauTau
</pre><p>For the analyser use: </p><pre class="fragment">git clone -b UL_ditau git@github.com:danielwinterbottom/ICHiggsTauTau.git UserCode/ICHiggsTauTau

</pre><p>If you want to run the vertex refitting you need to also clone this directory: </p><pre class="fragment">git clone git@github.com:danielwinterbottom/TauRefit.git VertexRefit/TauRefit/
<h1><a class="anchor" id="htt-ntuple-production-UL"></a>
Ntuple Production </h1>
<p>Ntuple production is done using the script </p><pre class="fragment">./test/crab_4tau.py. Here you can produce data and MC ntuples for each year.</p>
<h1><a class="anchor" id="htt-event-selection-UL"></a>
Selection of events </h1>
<p>Event selection is performed using HTTSequence.cc. As the name suggests the di-tau selection is applied for a given channel and sample, and it is possible to call and run the sequence multiple times within one job. </p>
<p>The submission of the multiple sequences is controlled using HTT.cpp, and a config.json file which contains various configurable parameters. One call to HTT.cpp is made for each of the backgrounds, data and signal, with optional multiple calls in separate jobs for subsets of the larger samples. This is controlled by the number of files read in each job. It is optionally possible to have systematic shifts such as tau energy scale included in the same job.</p>
</pre><p>Next, the following produces all of the necessary output files: </p><pre class="fragment">./scripts/htt_UL_2018.py --data --bkg --submit='./scripts/submit_ic_batch_job.sh "hep.q -l h_rt=0:180:0 -l h_vmem=24G"' --parajobs
</pre><p>The jobs can be submitted to IC batch (as in this example), the lxbatch, or run locally. The jobs are separated by number of input files.</p>
<h1><a class="anchor" id="htt-datacards-UL"></a>
Producing plots and datacards </h1>
<p>The output of HiggsTauTau.cpp is a set of flat trees containing all variables of importance. The first step is to combine the numbered output files for each sample resulting from the splitting by number of input files, using the following script: </p><pre class="fragment">./scripts/hadd_UL18_output.py --folder=output/Nov19/
</pre><p>The script contains a hardcoded list of the sample names to look for, and checks the number of completed jobs against the number of created jobs.</p>
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
</body>
</html>
